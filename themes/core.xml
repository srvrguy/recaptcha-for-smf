<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>motokochan:recaptchaforsmf</id>

	<file name="$themedir/Register.template.php">
		<operation>
			<search position="replace"><![CDATA[
	if ($context['visual_verification'])
	{
		echo '
					<tr valign="top">
]]></search>
			<add><![CDATA[
	if ($context['visual_verification'] || $context['use_recaptcha'])
	{
		echo '
					<tr valign="top">
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
							<b>', $txt['visual_verification_label'], ':</b>
							<div class="smalltext">', $txt['visual_verification_description'], '</div>
]]></search>
			<add><![CDATA[
							<b>', $txt['visual_verification_label'], ':</b>';
							if ($context['visual_verification'])
								echo '<div class="smalltext">', $txt['visual_verification_description'], '</div>';
		echo '
]]></add>
		</operation>

		<operation>
			<search position="after"><![CDATA[
		if ($context['use_graphic_library'])
			echo '
							<img src="', $context['verificiation_image_href'], '" alt="', $txt['visual_verification_description'], '" id="verificiation_image" /><br />';
]]></search>
			<add><![CDATA[
		if ($context['use_recaptcha'])
		{
			echo '
							<script>
							var RecaptchaOptions = {
							   theme : \'', empty($modSettings['recaptcha_theme']) ? 'clean' : $modSettings['recaptcha_theme'] , '\',
							};
							</script>
							<script type="text/javascript"
								src="http://api.recaptcha.net/challenge?k=', $modSettings['recaptcha_public_key'], '">
							 </script>
							 
							 <noscript>
								<iframe src="http://api.recaptcha.net/noscript?k=<your_public_key>"
									height="300" width="500" frameborder="0"></iframe><br>
								<textarea name="recaptcha_challenge_field" rows="3" cols="40">
								</textarea>
								<input type="hidden" name="recaptcha_response_field" 
									value="manual_challenge">
							 </noscript>';
		}
		else
		{
]]></add>
		</operation>

		<operation>
			<search position="after"><![CDATA[
	}

	// Are there age restrictions in place?
]]></search>
			<add><![CDATA[
		}
]]></add>
		</operation>

		<operation>
			<search position="after"><![CDATA[
						</tr><tr class="windowbg2" valign="top">
							<th width="50%" align="right">
								<label for="coppaAge_input">', $txt['admin_setting_coppaAge'], '</label> <span style="font-weight: normal;">(<a href="', $scripturl, '?action=helpadmin;help=coppaAge" onclick="return reqWin(this.href);">?</a>)</span>:
]]></search>
			<add><![CDATA[
						<tr class="windowbg2">
							<th width="50%" align="right">
								<label for="recaptchaEnable_check">', $txt['recaptcha_enable'], '</label>:
							</th>
							<td width="50%" align="left">
								<input type="checkbox" name="recaptchaEnable" id="recaptchaEnable_check" ', !empty($modSettings['recaptcha_enabled']) ? 'checked="checked"' : '', ' class="check" />
							</td>
						</tr><tr class="windowbg2">
							<th width="50%" align="right">
								<label for="recaptchaTheme">', $txt['recaptcha_theme'], '</label>:
							</th>
							<td width="50%" align="left">
								<select name="recaptchaTheme" id="recaptcha_theme_select">
									<option value="clean"', empty($modSettings['recaptcha_theme']) ? ' selected="selected"' : '', '>', $txt['recaptcha_theme_clean'], '</option>
									<option value="blackglass"', !empty($modSettings['recaptcha_theme']) && $modSettings['recaptcha_theme'] == "blackglass" ? ' selected="selected"' : '', '>', $txt['recaptcha_theme_blackglass'], '</option>
									<option value="red"', !empty($modSettings['recaptcha_theme']) && $modSettings['recaptcha_theme'] == "red" ? ' selected="selected"' : '', '>', $txt['recaptcha_theme_red'], '</option>
									<option value="white"', !empty($modSettings['recaptcha_theme']) && $modSettings['recaptcha_theme'] == "white" ? ' selected="selected"' : '', '>', $txt['recaptcha_theme_white'], '</option>
								</select>
							</td>
						</tr><tr class="windowbg2" valign="top">
							<th width="50%" align="right">
								<label for="recaptchaPublicKey_input">', $txt['recaptcha_public_key'], '</label>:
							</th>
							<td width="50%" align="left">
								<input type="text" name="recaptchaPublicKey" id="recaptchaPublicKey_input" value="', !empty($modSettings['recaptcha_public_key']) ? $modSettings['recaptcha_public_key'] : '', '" size="40" maxlength="40" />
							</td>
						</tr><tr class="windowbg2" valign="top">
							<th width="50%" align="right">
								<label for="recaptchaPrivateKey_input">', $txt['recaptcha_private_key'], '</label>:
							</th>
							<td width="50%" align="left">
								<input type="text" name="recaptchaPrivateKey" id="recaptchaPrivateKey_input" value="', !empty($modSettings['recaptcha_private_key']) ? $modSettings['recaptcha_private_key'] : '', '" size="40" maxlength="40" />
							</td>
						</tr><tr class="windowbg2" valign="top">
							<td colspan = "2" align="center">',
								$txt['recaptcha_no_key_question'],' <a href="http://recaptcha.net/api/getkey?app=recaptcha_for_smf&amp;domain=', $_SERVER['SERVER_NAME'], '">', $txt['recaptcha_get_key'], '</a>
							</td>
						</tr><tr class="windowbg2">
							<td width="100%" colspan="2" align="center">
								<hr />
							</td>
]]></add>
		</operation>
	</file>

</modification>
