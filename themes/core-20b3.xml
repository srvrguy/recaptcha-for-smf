<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>motokochan:recaptchaforsmf</id>

	<file name="$themedir/GenericControls.template.php">
		<operation>
			<search position="replace"><![CDATA[
		if ($i == 0 && $verify_context['show_visual'])
]]></search>
			<add><![CDATA[
		if ($i == 0 && ($verify_context['show_visual'] || $modSettings['recaptcha_enable']))
		{
			if ($modSettings['recaptcha_enable'])
			{
				echo '
				<script>
				var RecaptchaOptions = {
				   theme : \'', empty($modSettings['recaptcha_theme']) ? 'clean' : $modSettings['recaptcha_theme'] , '\',
				};
				</script>
				<script type="text/javascript"
					src="http://api.recaptcha.net/challenge?k=', $modSettings['recaptcha_public_key'], '">
				 </script>

				 <noscript>
					<iframe src="http://api.recaptcha.net/noscript?k=', $modSettings['recaptcha_public_key'], '"
						height="300" width="500" frameborder="0"></iframe><br />
					<textarea name="recaptcha_challenge_field" rows="3" cols="40">
					</textarea>
					<input type="hidden" name="recaptcha_response_field"
						value="manual_challenge">
				 </noscript>';
			}
			else
]]></add>
		</operation>

		<operation>
			<search position="before"><![CDATA[
					<input type="text" name="', $verify_id, '_vv[code]" value="', !empty($verify_context['text_value']) ? $verify_context['text_value'] : '', '" size="30" tabindex="', $context['tabindex']++, '" />
				</div>';
]]></search>
			<add><![CDATA[
			}
]]></add>
		</operation>

	</file>

</modification>
